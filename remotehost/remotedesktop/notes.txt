-0- ssh tunneling
-1- vnc
	-1.1- vncsession
	-1.2- tigervnc
		-1.2.1- setup/startup
			-1.2.1.1- blank screen/screensaver issue
		-1.2.2- Usage
	-1.3- wsl
	-1.4- wayland
-2- xrdp
	-2.1- setup

=================
-0- ssh tunneling
=================
	The client can be ssh tunneled to the remote server to encrypt the
	connection or bypass firewalls etc.
	Command:

		ssh user@host -L [local net]:(localport):(net on remote server):(remoteport) -f sleep 10 && vncviewer ...

	Usually, net (both local and remote) will be "localhost".
	"localport" is the port used at the local/client machine.
	"remoteport" is the port used at the remote/host machine.

	The -f will have the tunnel run in background and the sleep will make
	it run for a few seconds.  vncviewer should connect before the tunnel is
	closed.  The tunnel will last until vncviewer closes the connection.

	For more info, see notes at "/remotehost/ssh/notes.txt" section -1.3-

=======
-1- vnc
=======
	================
	-1.1- vncsession
	================
	This is the basic command used to create a vnc session.
	Sometimes, vncserver only leads to a black screen and nothing
	seems to open inside it.  However, using vncsession directly
	seems to allow opening windows (though desktop still fails...)
	vncsession requires root.

	sudo vncsession $USER :X
	==============
	-1.2- tigervnc
	==============
		===================
		-1.2.1- setup/startup
		===================
			HOST:
				Run commands:
					sudo apt install xfce4-session tigervnc-standalone-server xfce4-goodies

				Edit ~/.vnc/xstartup:
					unset SESSION_MANAGER
					unset DBUS_SESSION_BUS_ADDRESS
					startxfce4
			CLIENT:
				sudo apt install tigervnc-viewer
				vncviewer host:port [-passwd pathtofile]
					(if -passwd omitted, then enter password)

			======================================
			-1.2.1.1- blank screen/screensaver issue
			======================================
				After a period of inactivity, the virtual screen might be turned
				off.  When this happens, connecting and moving the mouse does not
				seem to turn it back on.  As a result, the screen is just left black
				with no response.
				Possible solutions:
					1. Run commands (needs a DISPLAY value)

					   xfconf-query -c xfce4-power-manager -p /xfce4-power-manager/blank-on-ac -s 0
					   xfconf-query -c xfce4-power-manager -p /xfce4-power-manager/dpms-on-ac-off -s 0
					   xfconf-query -c xfce4-power-manager -p /xfce4-power-manager/dpms-on-ac-sleep -s 0

					   The settings seem to persist, so only need to set this once.

					2. topleft applications->settings->power manager -> display tab
					   Turn all to never.
				Failed solutions:
					1. uninstall power management
					   sudo apt remove xfce4-power-manager-*
					2. ssh and try:
					   xset dpms force on

		===========
		-1.2.2- Usage
		===========
			HOST:
				creating:
					vncserver:
						-localhost
							yes|no        explicitly specify yes/no to only localhost
							              default is yes.  This is mainly for security.
							              The port can be ssh-tunneled and then the server
							              can be accessed via ssh.
						-NeverShared    Do not share the screen, only 1 user at a time.
						                You will be kicked off if someone else connects.

					UPDATE:
						arch linux, it seems like vncserver no longer manages servers.
						Instead it just starts as a process, ctrl c to shut it down.

				managing:
					vncserver:
						-list:          list the current sessions.
							:number|:*    list specified session
						-kill
							:number|:*    kill the vnc specified vnc session.
							-dry-run      don't actually kill
							-verbose      more verbose
							-clean        also clean log files
					vncpasswd:
						Prompt you for a password and maybe a view-only password too.

			CLIENT:
				vncviewer:
					[user@][host][:port]  Connect to specified vnc server.

	=========
	-1.3- wsl
	=========
	* WSL is generally wayland so see also: -1.4- wayland

	WSL generally has /tmp/.X11-unix/ mounted as read-only
	This results in vncserver being unable to create a new X display.

	From some research, it seems that /tmp/.X11-unix/ is a read-only bind mount
	of some kind to /mnt/wslg/.X11-unix/.

		evidence:
			>>> cd /mnt/wslg/.X11-unix/
			>>> touch a
			>>> ls /tmp/.X11-unix/
			X0 a
			>>> rm a
			>>> ls /tmp/.X11-unix/
			X0

	This means that to allow vnc to work:
		sudo umount /tmp/.X11-unix
		mkdir /tmp/.X11-unix
		chmod 1777 /tmp/.X11-unix
		for item in /mnt/wslg/.X11-unix/*
		do
			ln -s "${item}" "/tmp/.X11-unix/${item##*/}"
		done

	Alternatively, Write a systemd service, something like:
		[Unit]
		Description=Fix /tmp/.X11-unix dir permissions
		StartLimitIntervalSec=0

		[Service]
		Type=oneshot
		ExecStart=-/usr/bin/umount /tmp/.X11-unix
		ExecStart=/usr/bin/rm -rf /tmp/.X11-unix
		ExecStart=/usr/bin/mkdir /tmp/.X11-unix
		ExecStart=/usr/bin/chmod 1777 /tmp/.X11-unix
		ExecStart=/usr/bin/ln -s /mnt/wslg/.X11-unix/X0 /tmp/.X11-unix/X0

		[Install]
		WantedBy=multi-user.target

	=============
	-1.4- wayland
	=============
	NOTE: in this case, it is very possible that VNC will have no hardware
	acceleration at all and end up with very high CPU usage.

	In general, VNC is X only.
	On wayland systems, it is possible that applications will
	end up in the wayland environment rather than the vnc environment
	even if DISPLAY=:X and XDG_RUNTIME_DIR=x11 are set.

	In this case, it might be better to temporarily remove remove
	the corresponding wayland sockets to ensure that gui ends up
	in VNC instead.

	"${XDG_RUNTIME_DIR}/wayland*" are usually symlinks to /mnt/wslg/runtime-dir/wayland*

	ensure GUI goes to VNC:
		rm "${XDG_RUNTIME_DIR}/wayland"*

	Allow wayland:
		for item in "/mnt/wslg/runtime-dir/wayland"*
		do
			ln -s "${item}" "${XDG_RUNTIME_DIR}/${item##*/}"
		done



========
-2- xrdp
========
	=====
	-2.1-
	=====
		sudo apt install xrdp

		edit /etc/srdp/startwm.sh
		+ startxfce4
			  test -x /etc/X11/Xsession && exec /etc/X11/Xsession
			  exec /bin/sh /etc/X11/Xsession

		might have to:
			service xrdp status
			service xrdp start

		xrdp uses port 3389,
		but ssh tunnel attempts failed, something about already have a console session.
